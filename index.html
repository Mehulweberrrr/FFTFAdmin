<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FFTF Admin Pro | Control Center</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F3F4F6; }
        
        /* Sidebar Active State */
        .sidebar-link.active { background-color: #000; color: #fff; }
        .sidebar-link.active i { color: #FCD34D; }
        .mobile-link.active { color: #000; font-weight: 700; }
        .mobile-link.active i { color: #FCD34D; }
        
        /* Modal Animation */
        .modal { transition: opacity 0.2s ease, transform 0.2s ease; opacity: 0; pointer-events: none; transform: scale(0.95); }
        .modal.active { opacity: 1; pointer-events: auto; transform: scale(1); }

        /* Invoice Template (Hidden from screen, visible for PDF) */
        #invoice-template {
            width: 800px;
            background: white;
            padding: 40px;
            display: none; /* Hidden by default */
            font-family: 'Helvetica', sans-serif;
            color: #333;
        }
        .invoice-box { border: 1px solid #eee; padding: 20px; }
        .invoice-header { display: flex; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col md:flex-row overflow-hidden">

    <div id="invoice-template">
        <div class="invoice-header">
            <div>
                <h1 style="font-size: 30px; font-weight: bold;">FFTF.</h1>
                <p style="font-size: 12px; color: gray;">Finest Fit & Trendy Fashion</p>
            </div>
            <div style="text-align: right;">
                <h2 style="font-size: 18px; font-weight: bold;">TAX INVOICE</h2>
                <p style="font-size: 12px;">Order ID: <span id="inv-id">#12345</span></p>
                <p style="font-size: 12px;">Date: <span id="inv-date">2026-02-10</span></p>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
            <div style="width: 48%;">
                <p style="font-weight: bold; font-size: 14px; margin-bottom: 5px;">SOLD BY:</p>
                <p style="font-size: 12px; line-height: 1.5;">
                    <strong>FFTF Store</strong><br>
                    Dhankaul,Darbhanga,847407<br>
                    India,Bihar<br>
                    Email: support@fftf.com
                </p>
            </div>
            <div style="width: 48%;">
                <p style="font-weight: bold; font-size: 14px; margin-bottom: 5px;">BILLING / SHIPPING ADDRESS:</p>
                <p style="font-size: 12px; line-height: 1.5;" id="inv-customer">
                    </p>
            </div>
        </div>

        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
            <thead>
                <tr style="background-color: #f8f8f8; text-align: left;">
                    <th style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px;">ITEM</th>
                    <th style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px;">CATEGORY</th>
                    <th style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px; text-align: right;">PRICE</th>
                </tr>
            </thead>
            <tbody id="inv-items">
                </tbody>
        </table>

        <div style="text-align: right; margin-top: 20px;">
            <p style="font-size: 14px;">Grand Total: <span id="inv-total" style="font-weight: bold; font-size: 20px;">â‚¹0</span></p>
            <p style="font-size: 10px; color: gray; margin-top: 5px;">(Inclusive of all taxes)</p>
        </div>

        <div style="margin-top: 50px; border-top: 1px dashed #ccc; padding-top: 10px; text-align: center; font-size: 10px; color: gray;">
            This is a computer-generated invoice. No signature required. <br>
            Thank you for shopping with FFTF.
        </div>
    </div>
    <div id="login-screen" class="fixed inset-0 bg-gray-900 z-[100] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full">
            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4 text-yellow-600">
                <i class="ph-fill ph-shield-check text-3xl"></i>
            </div>
            <h1 class="text-2xl font-bold mb-1">Admin Access</h1>
            <p class="text-xs text-gray-500 mb-6">Enter your secure credentials</p>
            <form onsubmit="checkLogin(event)">
                <input type="password" id="admin-pass" placeholder="Password" class="w-full border border-gray-300 p-3 mb-4 rounded-xl focus:outline-none focus:border-black transition text-center font-bold" required>
                <button type="submit" class="w-full bg-black text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition shadow-lg">UNLOCK PANEL</button>
            </form>
            <p class="text-[10px] text-gray-400 mt-4">Default: admin123</p>
        </div>
    </div>

    <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col z-20 shadow-sm">
        <div class="h-20 flex items-center px-6 border-b border-gray-100">
            <h2 class="text-xl font-bold tracking-tight flex items-center gap-2">
                <i class="ph-fill ph-hexagon text-yellow-500"></i> FFTF<span class="text-gray-400 font-normal">Admin</span>
            </h2>
        </div>
        <nav class="flex-1 p-4 space-y-1">
            <button onclick="switchTab('orders')" id="desk-tab-orders" class="sidebar-link active w-full text-left px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 transition flex items-center gap-3">
                <i class="ph-bold ph-shopping-cart text-lg"></i> Orders
            </button>
            <button onclick="switchTab('products')" id="desk-tab-products" class="sidebar-link w-full text-left px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 transition flex items-center gap-3">
                <i class="ph-bold ph-package text-lg"></i> Products
            </button>
            <button onclick="switchTab('categories')" id="desk-tab-categories" class="sidebar-link w-full text-left px-4 py-3 rounded-xl text-gray-600 hover:bg-gray-50 transition flex items-center gap-3">
                <i class="ph-bold ph-squares-four text-lg"></i> Categories
            </button>
        </nav>
        <div class="p-4 border-t border-gray-100">
            <a href="index.html" target="_blank" class="flex items-center justify-center gap-2 w-full border border-gray-200 text-gray-700 py-2.5 rounded-xl font-bold text-sm hover:bg-gray-50 transition mb-2">
                <i class="ph-bold ph-arrow-square-out"></i> Live Site
            </a>
            <button onclick="location.reload()" class="w-full text-xs text-red-400 hover:text-red-600 font-bold">LOGOUT</button>
        </div>
    </aside>

    <header class="md:hidden h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 z-20 sticky top-0">
        <span class="font-bold text-lg flex items-center gap-2"><i class="ph-fill ph-hexagon text-yellow-500"></i> FFTF Admin</span>
        <a href="index.html" class="bg-black text-white px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1">View <i class="ph-bold ph-arrow-right"></i></a>
    </header>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 pb-24 md:pb-8 relative">
        
        <div id="view-orders" class="max-w-6xl mx-auto animate-fade">
            <h2 class="text-2xl font-bold mb-6">Order Dashboard</h2>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between">
                    <div><p class="text-xs text-gray-400 uppercase font-bold tracking-wider">Revenue</p><h3 class="text-2xl font-bold text-gray-900 mt-1" id="total-revenue">â‚¹0</h3></div>
                    <div class="bg-green-100 p-2 rounded-full text-green-600"><i class="ph-fill ph-currency-inr"></i></div>
                </div>
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between">
                    <div><p class="text-xs text-gray-400 uppercase font-bold tracking-wider">Orders</p><h3 class="text-2xl font-bold text-gray-900 mt-1" id="total-count">0</h3></div>
                    <div class="bg-blue-100 p-2 rounded-full text-blue-600"><i class="ph-fill ph-shopping-bag"></i></div>
                </div>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap">
                        <thead class="bg-gray-50 border-b border-gray-100 text-gray-400 text-xs uppercase font-bold tracking-wider">
                            <tr><th class="p-4">ID & Date</th><th class="p-4">Customer</th><th class="p-4">Total</th><th class="p-4">Status</th><th class="p-4 text-right">Actions</th></tr>
                        </thead>
                        <tbody id="orders-table" class="divide-y divide-gray-100 text-sm font-medium">
                            <tr><td colspan="5" class="p-8 text-center text-gray-400">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="view-products" class="max-w-6xl mx-auto hidden animate-fade">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Product Inventory</h2>
                <button onclick="toggleAddProduct()" class="bg-black text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-yellow-600 transition">
                    <i class="ph-bold ph-plus"></i> Add Product
                </button>
            </div>
            
            <div id="add-product-form" class="hidden bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8">
                <h3 class="font-bold text-lg mb-4">Add New Item</h3>
                <form onsubmit="addProduct(event)" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="p-name" placeholder="Product Name" class="bg-gray-50 border border-gray-200 p-3 rounded-xl w-full outline-none focus:border-black transition" required>
                        <input type="number" id="p-price" placeholder="Price (â‚¹)" class="bg-gray-50 border border-gray-200 p-3 rounded-xl w-full outline-none focus:border-black transition" required>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <select id="p-category" class="bg-gray-50 border border-gray-200 p-3 rounded-xl w-full outline-none focus:border-black transition cursor-pointer">
                            <option value="">Select Category...</option>
                        </select>
                        <input type="url" id="p-image" placeholder="Image URL" class="bg-gray-50 border border-gray-200 p-3 rounded-xl w-full outline-none focus:border-black transition" required>
                    </div>
                    <input type="url" id="p-meesho" placeholder="Meesho Product Link (Optional)" class="w-full bg-pink-50 border border-pink-200 p-3 rounded-xl outline-none focus:border-pink-500 text-pink-700 transition">
                    
                    <button type="submit" class="w-full bg-black text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition">PUBLISH ITEM</button>
                </form>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="products-list">
                </div>
        </div>

        <div id="view-categories" class="max-w-4xl mx-auto hidden animate-fade">
            <h2 class="text-2xl font-bold mb-6">Category Manager</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 h-fit">
                    <h3 class="font-bold text-lg mb-2">Create New Category</h3>
                    <form onsubmit="addCategory(event)" class="flex gap-2">
                        <input type="text" id="cat-name" placeholder="Category Name" class="bg-gray-50 border border-gray-200 p-3 rounded-xl w-full outline-none focus:border-black transition" required>
                        <button type="submit" class="bg-black text-white px-4 rounded-xl hover:bg-yellow-600 transition"><i class="ph-bold ph-plus"></i></button>
                    </form>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg mb-4">Active Categories</h3>
                    <div id="category-list" class="space-y-2 max-h-96 overflow-y-auto pr-2"><p class="text-gray-400 text-sm text-center">Loading...</p></div>
                </div>
            </div>
        </div>
    </main>

    <nav class="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around py-3 z-30 pb-safe">
        <button onclick="switchTab('orders')" id="mob-tab-orders" class="mobile-link active flex flex-col items-center text-gray-400"><i class="ph-fill ph-shopping-cart text-2xl mb-0.5"></i><span class="text-[10px]">Orders</span></button>
        <button onclick="switchTab('products')" id="mob-tab-products" class="mobile-link flex flex-col items-center text-gray-400"><i class="ph-fill ph-package text-2xl mb-0.5"></i><span class="text-[10px]">Products</span></button>
        <button onclick="switchTab('categories')" id="mob-tab-categories" class="mobile-link flex flex-col items-center text-gray-400"><i class="ph-fill ph-squares-four text-2xl mb-0.5"></i><span class="text-[10px]">Cats</span></button>
    </nav>

    <div id="order-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 modal px-4">
        <div class="bg-white w-full max-w-md p-6 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 bg-gray-100 p-2 rounded-full hover:bg-gray-200"><i class="ph-bold ph-x"></i></button>
            <h3 class="text-xl font-bold mb-1">Order Details</h3>
            <p class="text-xs text-gray-400 uppercase tracking-widest mb-6" id="modal-id">#ID</p>
            <div id="modal-content" class="space-y-4"></div>
            
            <div class="mt-6 flex flex-col gap-2">
                <button id="print-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                    <i class="ph-bold ph-printer"></i> PRINT INVOICE
                </button>
                <button onclick="closeModal()" class="w-full bg-gray-100 text-gray-800 py-3 rounded-xl font-bold hover:bg-gray-200">Close</button>
            </div>
        </div>
    </div>

    <script>
        // ðŸ”¥ðŸ”¥ðŸ”¥ PASTE YOUR API KEY HERE ðŸ”¥ðŸ”¥ðŸ”¥
        const firebaseConfig = {
            apiKey: "PASTE_YOUR_API_KEY_HERE", 
            authDomain: "fftf-online.firebaseapp.com",
            databaseURL: "https://fftf-online-default-rtdb.firebaseio.com",
            projectId: "fftf-online",
            storageBucket: "fftf-online.appspot.com",
            messagingSenderId: "846660604850",
            appId: "1:846660604850:web:9f8e7d6c5b4a3b2c1d0e9f"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function checkLogin(e) {
            e.preventDefault();
            if(document.getElementById('admin-pass').value === "admin123") {
                document.getElementById('login-screen').style.display = 'none';
                loadData();
            } else { alert("Incorrect Password"); }
        }

        function switchTab(tab) {
            ['orders', 'products', 'categories'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('desk-tab-' + t).classList.remove('active');
                document.getElementById('mob-tab-' + t).classList.remove('active', 'text-black');
                document.getElementById('mob-tab-' + t).classList.add('text-gray-400');
            });
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('desk-tab-' + tab).classList.add('active');
            document.getElementById('mob-tab-' + tab).classList.remove('text-gray-400');
            document.getElementById('mob-tab-' + tab).classList.add('active', 'text-black');
        }

        function toggleAddProduct() { document.getElementById('add-product-form').classList.toggle('hidden'); }

        function loadData() {
            // ORDERS
            db.ref('orders').on('value', snap => {
                const data = snap.val();
                const tbody = document.getElementById('orders-table');
                tbody.innerHTML = "";
                let rev = 0, count = 0;
                if(data) {
                    Object.keys(data).reverse().forEach(key => {
                        const o = data[key];
                        const amount = parseInt(o.total.toString().replace(/[^0-9]/g, '')) || 0;
                        rev += amount; count++;
                        const badge = o.status === 'Shipped' ? 'bg-blue-100 text-blue-700' : o.status === 'Delivered' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600';
                        tbody.innerHTML += `
                            <tr class="hover:bg-gray-50 border-b border-gray-100 last:border-0">
                                <td class="p-4"><div class="font-bold text-gray-900">#${key.slice(-4)}</div><div class="text-xs text-gray-400">${new Date(o.date).toLocaleDateString()}</div></td>
                                <td class="p-4 font-bold">${o.customer.name}</td>
                                <td class="p-4 font-bold">${o.total}</td>
                                <td class="p-4"><select onchange="updateStatus('${key}', this.value)" class="text-xs font-bold px-2 py-1 rounded-lg border-0 cursor-pointer ${badge}"><option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option><option value="Shipped" ${o.status==='Shipped'?'selected':''}>Shipped</option><option value="Delivered" ${o.status==='Delivered'?'selected':''}>Delivered</option></select></td>
                                <td class="p-4 text-right"><button onclick="viewOrder('${key}')" class="text-gray-400 hover:text-black p-2"><i class="ph-bold ph-eye text-lg"></i></button><button onclick="deleteOrder('${key}')" class="text-gray-400 hover:text-red-500 p-2"><i class="ph-bold ph-trash text-lg"></i></button></td>
                            </tr>`;
                    });
                } else { tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400">No orders yet.</td></tr>`; }
                document.getElementById('total-revenue').innerText = "â‚¹" + rev.toLocaleString();
                document.getElementById('total-count').innerText = count;
            });

            // CATEGORIES
            db.ref('categories').on('value', snap => {
                const data = snap.val();
                const list = document.getElementById('category-list');
                const dropdown = document.getElementById('p-category');
                list.innerHTML = "";
                dropdown.innerHTML = `<option value="">Select Category...</option>`;
                if(data) {
                    Object.keys(data).forEach(key => {
                        const name = data[key].name;
                        list.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl border border-gray-100"><span class="font-bold">${name}</span><button onclick="deleteCategory('${key}')" class="text-red-400 hover:text-red-600 bg-white p-2 rounded-lg shadow-sm"><i class="ph-bold ph-trash"></i></button></div>`;
                        dropdown.innerHTML += `<option value="${name}">${name}</option>`;
                    });
                } else { list.innerHTML = `<p class="text-gray-400 text-sm text-center">No categories found.</p>`; }
            });

            // PRODUCTS
            db.ref('products').on('value', snap => {
                const data = snap.val();
                const list = document.getElementById('products-list');
                list.innerHTML = "";
                if(data) {
                    Object.keys(data).forEach(key => {
                        const p = data[key];
                        const meeshoBadge = p.meeshoLink ? `<span class="absolute top-2 left-2 bg-pink-600 text-white text-[9px] px-2 py-1 rounded-full font-bold">MEESHO</span>` : '';
                        list.innerHTML += `
                            <div class="bg-white p-3 rounded-2xl border border-gray-100 relative group">
                                ${meeshoBadge}
                                <div class="aspect-[3/4] bg-gray-100 rounded-xl overflow-hidden mb-3">
                                    <img src="${p.image}" class="w-full h-full object-cover">
                                </div>
                                <h4 class="font-bold text-sm truncate">${p.name}</h4>
                                <div class="flex justify-between items-center mt-1">
                                    <span class="text-[10px] font-bold bg-gray-100 px-2 py-0.5 rounded text-gray-500">${p.category}</span>
                                    <span class="font-bold text-sm">â‚¹${p.price}</span>
                                </div>
                                <button onclick="deleteProduct('${key}')" class="absolute top-2 right-2 bg-white text-red-500 w-8 h-8 rounded-full shadow flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="ph-bold ph-trash"></i></button>
                            </div>
                        `;
                    });
                }
            });
        }

        // ACTIONS
        window.addCategory = (e) => {
            e.preventDefault();
            const name = document.getElementById('cat-name').value.trim();
            if(name) { db.ref('categories').push({ name: name }); e.target.reset(); }
        };
        window.deleteCategory = (id) => { if(confirm("Delete category?")) db.ref('categories/' + id).remove(); };

        window.addProduct = (e) => {
            e.preventDefault();
            const newProduct = {
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                category: document.getElementById('p-category').value,
                image: document.getElementById('p-image').value,
                meeshoLink: document.getElementById('p-meesho').value
            };
            if(!newProduct.category) return alert("Please select a category");
            db.ref('products').push(newProduct);
            e.target.reset();
            alert("Product Added!");
            toggleAddProduct();
        };
        window.deleteProduct = (id) => { if(confirm("Delete Product?")) db.ref('products/' + id).remove(); };
        window.deleteOrder = (id) => { if(confirm("Delete Order?")) db.ref('orders/' + id).remove(); };
        window.updateStatus = (id, val) => db.ref('orders/' + id).update({status: val});

        window.viewOrder = (id) => {
            db.ref('orders/' + id).once('value', snap => {
                const o = snap.val();
                document.getElementById('modal-id').innerText = "ORDER ID: #" + id.slice(-6);
                const content = document.getElementById('modal-content');
                let itemsHtml = o.items.map(i => `<div class="flex items-center gap-3 bg-gray-50 p-2 rounded-xl border border-gray-100"><img src="${i.image}" class="w-10 h-10 rounded-lg object-cover"><div><p class="text-xs font-bold">${i.name}</p><p class="text-[10px] text-gray-500">â‚¹${i.price}</p></div></div>`).join('');
                content.innerHTML = `<div class="bg-gray-50 p-4 rounded-xl space-y-2 border border-gray-100"><div class="flex gap-2 text-sm font-bold"><i class="ph-fill ph-user"></i> ${o.customer.name}</div><div class="flex gap-2 text-xs text-gray-500"><i class="ph-fill ph-phone"></i> ${o.customer.phone}</div><div class="flex gap-2 text-xs text-gray-500"><i class="ph-fill ph-map-pin"></i> ${o.customer.address}, ${o.customer.city}</div></div><div class="max-h-40 overflow-y-auto space-y-2 pr-1">${itemsHtml}</div><div class="flex justify-between items-center pt-4 border-t border-gray-100"><span class="text-sm text-gray-400 font-bold">Total Bill</span><span class="text-xl font-bold text-black">${o.total}</span></div>`;
                
                // SETUP PDF GENERATION DATA
                document.getElementById('inv-id').innerText = "#" + id.slice(-6).toUpperCase();
                document.getElementById('inv-date').innerText = new Date(o.date).toLocaleDateString();
                document.getElementById('inv-customer').innerHTML = `<strong>${o.customer.name}</strong><br>${o.customer.phone}<br>${o.customer.address}<br>${o.customer.city} - ${o.customer.zip}`;
                
                let invItemsHtml = o.items.map(i => `<tr><td style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px;">${i.name}</td><td style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px;">${i.category}</td><td style="padding: 10px; border-bottom: 1px solid #ddd; font-size: 12px; text-align: right;">â‚¹${i.price}</td></tr>`).join('');
                document.getElementById('inv-items').innerHTML = invItemsHtml;
                document.getElementById('inv-total').innerText = o.total;

                // CLICK EVENT FOR PDF
                document.getElementById('print-btn').onclick = function() {
                    const element = document.getElementById('invoice-template');
                    element.style.display = 'block'; // Show temporarily
                    const opt = { margin: 0, filename: 'Invoice_'+id.slice(-6)+'.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' } };
                    html2pdf().set(opt).from(element).save().then(() => { element.style.display = 'none'; }); // Hide after save
                };

                document.getElementById('order-modal').classList.add('active');
            });
        };
        window.closeModal = () => document.getElementById('order-modal').classList.remove('active');
    </script>
</body>
</html>